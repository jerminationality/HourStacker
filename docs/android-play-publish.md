# Android Play Store publishing (Trusted Web Activity)

This project is a PWA (Next.js + Service Worker). The recommended way to publish it to Google Play is Trusted Web Activity (TWA) using Bubblewrap.

## Overview
- Wrap your PWA inside a minimal Android app (TWA) generated by Bubblewrap.
- Verify your app and website with Digital Asset Links.
- Build an Android App Bundle (.aab) and upload it to Google Play Console.

## Prerequisites
- A production HTTPS domain for your PWA (e.g., https://yourdomain.com).
- Service worker enabled and working (already present in this repo).
- Installed tooling:
  - Java 17+ (Temurin/OpenJDK)
  - Android SDK + Build Tools (or install on first Bubblewrap build)
  - Node.js LTS
  - Bubblewrap CLI (we’ll use `npx` in commands)

## 1) Set app metadata
Edit `twa/twa-manifest.json` and replace placeholders:

- `packageId`: Unique app ID, e.g., `com.yourcompany.hourstacker`
- `host`: Your live domain, e.g., `yourdomain.com`
- `fullScopeUrl`: E.g., `https://yourdomain.com/`
- `startUrl`: PWA start path, e.g., `/`
- `iconUrl` / `maskableIconUrl`: Absolute HTTPS URLs to 512×512 icons
- `appVersionName` / `appVersionCode`: Semantic name and incrementing code
- `themeColor` / `navigationColor` / `backgroundColor`: Brand colors
- Signing (optional in manifest): you can also use Play App Signing

## 2) Generate Android project

From the repo root (Windows PowerShell):

```powershell
pwsh -File .\scripts\twa-init.ps1
```

This will create an `android/` folder containing the TWA Android project.

## 3) Set up Digital Asset Links

Place an `assetlinks.json` at `https://yourdomain.com/.well-known/assetlinks.json` referencing your app’s signing certificate fingerprint(s).

Use `public/.well-known/assetlinks.json.example` as a template. Copy it to `public/.well-known/assetlinks.json` and update:

- `package_name`: Your `packageId`
- `sha256_cert_fingerprints`: Your signing cert SHA-256 fingerprint(s)

Notes:
- If you use Play App Signing, use the App Signing certificate fingerprint from Play Console.
- Deploy your site so the file is publicly reachable before Play review.

## 4) Build the App Bundle

```powershell
pwsh -File .\scripts\twa-build.ps1
```

Artifacts:
- `android/app/build/outputs/bundle/release/app-release.aab`

If prompted, Bubblewrap can install Android SDK components. You can also open the `android/` folder in Android Studio.

## 5) Google Play Console
1. Create a new app (Production or start with Internal testing).
2. Upload the `.aab`.
3. Complete required sections: App content, Data safety, Privacy policy URL, Screenshots, Icons, Feature graphics, Category, Content rating.
4. Submit for review.

## 6) Update strategy / cache busting
To ensure PWA updates propagate:
- Use a versioned Service Worker URL in your registration (e.g., `/sw.js?v=0.9`).
- In the SW, bump cache names and remove old caches in `activate`.
- Call `self.skipWaiting()` and `self.clients.claim()`.

## Troubleshooting
- White screen / not loading: check `assetlinks.json` URL + fingerprint accuracy.
- SW not updating: verify SW URL versioning and cache cleanup.
- Play signing mismatch: ensure fingerprints match the uploaded signing cert.

## Helpful commands
- Print SHA-256 fingerprint from keystore:
  ```powershell
  keytool -list -v -keystore path\to\your.keystore -alias your_alias
  ```
- Print Play App Signing certificate (from Console): App > App integrity > App signing

## References
- Bubblewrap: https://github.com/GoogleChromeLabs/bubblewrap
- TWA docs: https://web.dev/trusted-web-activity/
